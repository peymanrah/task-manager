# SCI: Structural Causal Invariance for Compositional Generalization

## Overview
**Repo:** https://github.com/peymanrah/SCI  
**Target:** Nature Machine Intelligence  
**Language:** Python 85%, HTML 15%  
**License:** MIT

Research implementation achieving **4.4× improvement** on out-of-distribution generalization on the SCAN compositional benchmark.

## Key Results
| Model | In-Dist Acc | OOD Acc | Comp Gen | Struct Inv |
|---|---|---|---|---|
| Baseline | 95.2% | 19.8% | 52.1% | 0.42 |
| SCI (Full) | **98.1%** | **87.3%** | **91.7%** | **0.89** |

## Architecture
Four components integrated with **TinyLlama-1.1B** base model:
1. **Structural Encoder (SE)** — AbstractionLayer at layers [3, 6, 9], learns structural patterns invariant to content
2. **Content Encoder (CE)** — independent content encoding enforced via orthogonality loss
3. **Causal Binding Mechanism (CBM)** — cross-attention binding content to structural slots + EdgePredictor
4. **Structural Contrastive Learning (SCL)** — auto-generated positive/negative pairs, weight 0.3 with warmup

### Config
- TinyLlama-1.1B base, 12-layer SCI encoders (512d → 2048d)
- Batch size 32, fp16 mixed precision
- RTX 3090 (24GB VRAM) optimized

## Project Structure
```
SCI/
├── sci/                      # Main package
│   ├── models/               # Core architecture (sci_model.py, components/)
│   │   └── components/       # AbstractionLayer, encoders, CBM, EdgePredictor
│   │   └── losses/           # SCL, orthogonality, EOS losses
│   ├── data/                 # Data loading & preprocessing
│   ├── training/             # Training logic
│   └── evaluation/           # Evaluation & metrics
├── configs/                  # YAML configs
│   ├── base_config.yaml
│   ├── sci_full.yaml
│   ├── baseline.yaml
│   └── ablations/            # 7 ablation configs
├── scripts/                  # train_baseline.py, train_sci.py, evaluate.py, generate_figures.py
├── tests/                    # Component, data leakage, integration tests
└── documents/                # Technical documentation
```

## Commands
```bash
# Setup
pip install -r requirements.txt && pip install -e .

# Test
pytest tests/ -v --cov=sci --cov-report=html

# Train
python scripts/train_baseline.py --config configs/baseline.yaml --output_dir checkpoints/baseline
python scripts/train_sci.py --config configs/sci_full.yaml --output_dir checkpoints/sci_full

# Ablations
python scripts/train_sci.py --config configs/ablations/no_abstraction_layer.yaml --output_dir checkpoints/ablation_no_al
python scripts/train_sci.py --config configs/ablations/no_scl.yaml --output_dir checkpoints/ablation_no_scl

# Evaluate
python scripts/evaluate.py --checkpoint checkpoints/sci_full/final.pt --config configs/sci_full.yaml --splits simple length template

# Figures
python scripts/generate_figures.py --results_dir results/ --output_dir figures/generated/
```

## Known Issues
- Extensive bug fix history (V1–V10 reports, 85+ bugs documented and resolved)
- EdgePredictor for Causal Binding Mechanism recently added (latest commit)
- Data leakage checks are critical — dedicated test category
- Config alignment fixes applied for fair ablation comparisons

## Checklist
- [ ] Clone repo & set up Python 3.9+ venv with CUDA/PyTorch
- [ ] Verify all tests pass (`pytest tests/ -v`)
- [ ] Train baseline model → checkpoint
- [ ] Train SCI full model → checkpoint
- [ ] Run 7 ablation studies
- [ ] Evaluate all models on SCAN splits (simple, length, template)
- [ ] Verify EdgePredictor integration works correctly
- [ ] Generate publication figures
- [ ] Prepare Nature Machine Intelligence submission

## Hardware
- GPU: RTX 3090 (24GB VRAM) recommended
- RAM: 64GB+
- CUDA: 11.7+
- Python: 3.9+
