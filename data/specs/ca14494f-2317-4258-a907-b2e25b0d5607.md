# Task Manager Control Tower ‚Äî Spec

## Overview
Build a professional-grade **Task Manager Control Tower** for VS Code that tracks tasks, subtasks, progress, GitHub links, and activity logs in real-time via a local web UI. Expose all functionality via MCP (Model Context Protocol) so any VS Code Copilot agent in any window can manage tasks.

## Architecture
- **Server**: Express 4 + WebSocket (ws) on port 4567
- **Client**: React 18 + Vite + Tailwind CSS (served as static build from server)
- **Data**: JSON file store with chokidar file-watcher for live reload
- **MCP Server**: Stdio-based MCP server (mcp-server.js) exposing 13 tools
- **CLI**: ts-node scripts for creating/updating/logging tasks from terminal

## Key Requirements
- [x] No external LLM API calls ‚Äî all AI interaction via VS Code Copilot chat
- [x] Real-time WebSocket push on data changes
- [x] Glass-morphism dark UI with progress bars, status badges
- [x] Per-task spec.md visible in UI with Markdown rendering
- [x] Dark/light mode toggle with localStorage persistence
- [x] Auto-start server when VS Code workspace opens
- [x] Tests isolated from production data
- [x] MCP server for cross-window agent access
- [x] Timeline view for chronological event tracking
- [x] Spec export/import for portability
- [x] Lessons learned per task for AI personalization

## Tech Stack
| Layer | Tech |
|-------|------|
| Runtime | Node.js 24.13.0 LTS |
| Server | Express 4.18, ws 8.16, chokidar 3.6 |
| Client | React 18.2, Vite 5, Tailwind 3.4, lucide-react, react-markdown |
| MCP | @modelcontextprotocol/sdk 1.26.0 |
| Testing | Jest 29.7 (30/30 passing) |
| VCS | Git + GitHub (peymanrah/task-manager) |

## Considerations
- Server must handle EADDRINUSE gracefully (auto-retry)
- Tests use `TASK_MANAGER_DATA_FILE` env var to avoid wiping production data
- PowerShell `Out-File` adds UTF-8 BOM ‚Äî always use `[IO.File]::WriteAllText` instead
- Auto-start configured via `.vscode/tasks.json` + `task.allowAutomaticTasks: "on"`
- Workspace path has a space ‚Äî scripts must quote paths properly

## ‚úÖ What Worked
- **JSON file store + chokidar watcher** ‚Äî zero-config persistence with live-reload push to UI. Simple and reliable.
- **MCP over stdio** ‚Äî perfect fit for cross-workspace agent access. No HTTP needed, the agent calls tools directly.
- **CSS custom properties for theming** ‚Äî switching dark/light is instant via `data-theme` attribute, no re-render needed.
- **Monorepo with npm workspaces** ‚Äî server + client share dependencies cleanly, single `npm install` at root.
- **Glass-morphism UI with Tailwind** ‚Äî `backdrop-blur` + `border` gives professional look with minimal CSS.
- **Test isolation via env var** ‚Äî `TASK_MANAGER_DATA_FILE` lets Jest use temp dirs, never touches production data again.
- **react-markdown for spec rendering** ‚Äî drop-in Markdown viewer with zero config, styles scoped via `.spec-markdown` class.

## ‚ùå What Didn't Work
- **PowerShell `Out-File`** ‚Äî silently adds UTF-8 BOM (`EF BB BF`), breaking JSON.parse(). Wasted hours debugging. Always use `[IO.File]::WriteAllText()` instead.
- **Jest `beforeEach` resetting production data** ‚Äî `resetTasksFile()` wrote `[]` to the real `data/tasks.json`, wiping all tasks. Had to recover from git history.
- **`text-white` hardcoded in Tailwind** ‚Äî broke everything in light mode. Must use CSS variable tokens (`text-tower-text`) from the start.
- **VS Code task with space in path** ‚Äî `powershell.exe -File "${workspaceFolder}\start-server.ps1"` fails when path contains spaces. Fixed with `cd` first then relative path.
- **Running server in same terminal as CLI** ‚Äî terminal tool sends SIGINT to the running process. Server needs its own dedicated/background terminal.
- **Tailwind `@apply` with opacity on CSS variable colors** ‚Äî `bg-tower-border/50` in `@apply` directives fails at build time. Must use `color-mix()` in raw CSS instead.

## üß† AI Agent Notes
- User prefers concise, professional UI with no clutter. Dark mode is default.
- User values real-time feedback ‚Äî always implement WebSocket push, not polling.
- User works across multiple VS Code windows ‚Äî MCP server is essential for cross-workspace task management.
- User's Windows setup has conda base env active by default, which sometimes interferes with PATH.
- Always refresh PATH at terminal start: `$env:PATH = [System.Environment]::GetEnvironmentVariable("PATH","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("PATH","User")`
- GitHub CLI (`gh`) is authenticated as `peymanrah` via Windows keyring.
- User expects agent to proactively track tasks ‚Äî ask "Should I track this in Control Tower?" when starting new work.

## Status: ‚úÖ Done
